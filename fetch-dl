#!/usr/bin/python

import sys
import os
import random
import string
if int(sys.argv[1]) == 404 or int(sys.argv[1]) == 504:
  sys.exit("ERROR: Episodes 404 \"Ruff Pigs Out and Has a Whale of a Time\" and 504 \"The Ol' Shell Game\" are disabled.")
episodehash={
    101:"37e54b8a98924641a3a84115ab3e8f7f",
    102:"10776ba6b12144e690ccedacc2249d6a",
    103:"efe07f33f43348c79ddd48d588507266",
    104:"f30720a920ac47b5af9378e0ea2adb86",
    105:"d899f114044d4ec684e1cf113e2c7a86",
    106:"0f419e7258574fcd83a4839aea4d85f5",
    107:"727bf24465b74341a25005467fdd9fc2",
    108:"b9c54f9de86b476fac686ecbbe5ad7d7",
    109:"c7b760d06c9c4c61b2f5ecb21644891d",
    110:"da4729e21a894922b4625ec2f1d0e4e7",
    111:"f80d5447079a46f8a3c977fd42d7decb",
    112:"d09f014bd99c482f98f7eea9e3e5ddf3",
    113:"327e5486ace447308decf6e9925ac49b",
    114:"149feffe7833479c85715082713989de",
    115:"a54b6da05386416d8db496778d9c6e01",
    116:"5149dc5c01bb4376b247f42519a635d5",
    117:"43ea7dcfb43845198a4df9ceccf9dd17",
    118:"bd4c98e025994ea99e523fd069cde4e1",
    119:"96b3e0ca889043b5b2b7a60167744c2b",
    120:"2b736602b9cb4405b3eb36302fd7618c",
    201:"144bf0e907a04484b9178cc6da6f0a21",
    202:"7ffab0e610984f9cb2e2d3a45d6a161d",
    203:"85a6d6bc053d40c1a5e569be5a8c8c8f",
    204:"9957ce0e9b944365838e500f48cb3b92",
    205:"ed534a96ba1c482a971758dd32558778",
    206:"c585e08072fd4b308fb90cafce2be530",
    207:"918b99b89e914c06aa24e11230703e51",
    208:"0ee8637a44674275b4f81391b5443646",
    209:"150c028ff9784544bbf943fc1f5022fb",
    210:"6b8d0a68fe25453fa47604dfd79be32f",
    211:"cab2d591f86448bfa430c28bea4f8a03",
    212:"c1577637047d440d90fd96ff948b9402",
    213:"cd271b4705c44dcb829a0e23cc389f75",
    214:"b3948e9e85e94df08c69ac0c53f336ba",
    215:"9f149d5e816b41da8d6a21b0ab0ef19e",
    216:"33d671044e424e4e8feb66e6ca80f335",
    217:"00a82d789cac4ded80ef14048a13fd7a",
    218:"5b013170a42c49ffb8b537ee49b950d2",
    219:"62ea9eec6c974a9fa09d573dc65cade2",
    220:"9ccc0147916e4588af1eaa2a225b25c4",
    301:"3fcaf4819f6040e594faf880923833f1",
    302:"fde9cdaa917f4e479a71ed033724f20b",
    303:"27440e99f32447c7ae87cdd2446e4380",
    304:"a9131f9e0c3c4348982ec91e74d3393f",
    305:"857438b33f4f4d2daf2bb5e358f5ba51",
    306:"fe342bffcf994b5aaf0a9a2915328f07",
    307:"1f60428d779b40d8903974881484ef4d",
    308:"9b4fc51f6d6e45d19cc0f74fefa50de1",
    309:"ddbbe5052bcd4ce2a34f9f6d871f3a5c",
    310:"286bf8451eed4b48b230594fa8f99496",
    311:"897c6b22d94c446b91274462efb0bfa2",
    312:"14af2957addc4f85bef5c5f20d1dd47e",
    313:"f53363ec4aef4a56a936c190e48190ce",
    314:"7545fa1563b24f0a878bc169dc0c3674",
    315:"6597380518de48f1b1186b19d4996720",
    316:"6a3de0bfb4b444f7861a28260302e881",
    317:"fc9852acc72643248a8ee426bf49e830",
    318:"db3c762e2a1d497ab2f0c43cca209c2d",
    319:"80c31c42bba04b5ab1f1f688d523c62f",
    320:"9e48ef6dbc9d4f17b3c2ea4be50931f8",
    401:"d4fe0c399f924191ac5ee0c1074b7a6f",
    402:"cea0d041acf84fbdbedf1b254af19241",
    403:"9ecbb8d91ec64caa8acd4f93d437ac35",
    405:"362519cd255e481cad9af814c2652401",
    406:"b0dc6aa08bb342eca05587a87ca557a3",
    407:"0142536b0bfa4cafb6ebaddbeb91c8c1",
    408:"857e0f235e814b168714b8a48972c3fc",
    409:"7e6c5fdc0c4d483197c8d3e7bd1dec45",
    410:"1ad0b2565f4c478384e3014c3bd61a83",
    411:"7a4068bb8eba42c59870765ea9c3f90d",
    412:"0419b7219bd0464daa5d1fcc3b3b149a",
    413:"b701ed665fdf4ca0a0b5202526e2c287",
    414:"d030e9707ee74f5da173074f10b8595c",
    415:"6bd1fd5d0da34926abf53b08b88dcaa0",
    416:"d8213b46ee414c15a1accca76aca78b5",
    417:"1e5a528e0d204b01b065e0d55ba16123",
    418:"0bde484fcd6a47d6a5cacff5696be742",
    419:"2df178b47e634c37833468d2ff7b0688",
    420:"373c7fcc03c74fcf948dd3297388c4ea",
    501:"9a2dab19a69c401aae77e7a08134d32f",
    502:"e06fc06255c146df9abc7eb6416905ce",
    503:"719b2cfc946c40a5af0c27c67361e68a",
    505:"e2db2fadd71040e68d0840246fa053ab",
    506:"c9b9c0f129b246fda4b431ce1279a832",
    507:"9d61b2fbbd284725a8ca5827cba4ee4b",
    508:"022b212420284aeaa1d7287e3895124f",
    509:"b8b6f5c05aaa41229080190c2b2acb6c",
    510:"f1e801b03de94c9cb1281224775368d0",
    511:"0ea9aaa2d6514aac8a6b4c338f5e39a4",
    512:"9d51a8ca36304baeb738d651d8fa2f35",
    513:"561a13b66c9f4b5db95b38b04c890373",
    514:"c07fe9154f3c4d01a4e4f4075a952226",
    515:"4bd19d8b1b324b618bc1b2b09d105735",
    516:"c7cc4d04bba24c04ad2084dcbe53514a",
    517:"dfa82006790e425facf0931a1258b9c1",
    518:"9d3f25bc69184196ab081bc85ef09b41",
    519:"36e5b847a24342af80e0d5dc851a071b",
    520:"05080eacc4664eb589ce6f562f9714c9",
  }.get(int(sys.argv[1]),None)
if episodehash is None:
  sys.exit("ERROR: Invalid episode number.  Episode numbers should be in the following format: Season number (1-5) followed by episode number (01-20)")
randomstring=''.join(random.choice(string.ascii_uppercase + string.digits) for _ in range(10))
if os.name == "nt":
  os.system("curl -silent http://urs.pbs.org/redirect/"+episodehash+"/ >> \%temp\%\\fetch-dl-"+randomstring)
  f=open('\%temp\%\\fetch-dl-'+randomstring, 'r')
else:
  os.system("curl -silent http://urs.pbs.org/redirect/"+episodehash+"/ >> /tmp/fetch-dl-"+randomstring)
  f=open('/tmp/fetch-dl-'+randomstring, 'r')
url=f.read().split("<a href=\"")[1].split("\"")[0]
f.close()
os.system("ffmpeg -i "+url+" "+sys.argv[2])
